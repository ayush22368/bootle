<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Phantom Mobile Wallet Connect</title>
</head>
<body>
  <h2>Phantom Mobile Wallet Connect (MWA)</h2>
  <button id="connectBtn">Connect Wallet</button>
  <p id="status">Not connected</p>

  <script type="module">
    import { transact } from 'https://cdn.jsdelivr.net/npm/@solana-mobile/mobile-wallet-adapter-protocol@1.0.3/dist/index.browser.esm.js';

    const status = document.getElementById("status");
    const connectBtn = document.getElementById("connectBtn");

    // Restore last session if already authorized
    async function restoreSession() {
      try {
        const address = await transact(async (wallet) => {
          const accounts = await wallet.getAccounts();
          if (accounts.length > 0) {
            return accounts[0].address;
          }
          return null;
        });
        if (address) {
          status.textContent = "Connected: " + address;
        }
      } catch (err) {
        console.log("No previous session found.");
      }
    }

    connectBtn.addEventListener("click", async () => {
      try {
        const address = await transact(async (wallet) => {
          const auth = await wallet.authorize({
            cluster: 'solana:mainnet-beta',
            identity: {
              name: 'My Mobile dApp',
              uri: window.location.origin
            }
          });
          return auth.accounts[0].address;
        });

        status.textContent = "Connected: " + address;
      } catch (err) {
        console.error("Connection error:", err);
        status.textContent = "Connection failed or cancelled";
      }
    });

    // Try restoring connection on load
    restoreSession();
  </script>
</body>
</html>
