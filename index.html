<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Connect Phantom (Custom-Tab)</title>
  <style>
    html,body{margin:0;height:100%;background:#0e0e0e;color:#fff;font-family:sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center}
    button{background:#9945ff;color:#fff;border:none;padding:16px 32px;font-size:1.2rem;border-radius:8px;cursor:pointer;margin-bottom:24px}
    #addr{margin-top:20px;font-size:1rem;color:#00ffa3;word-break:break-all}
  </style>
</head>
<body>
  <button id="btn">Connect Wallet</button>
  <div id="addr"></div>

  <script type="module">
    /* ---------- detect environment ---------- */
    const inCustomTab = /wv|Mobile.*Chrome/i.test(navigator.userAgent) && !/Phantom/i.test(navigator.userAgent);

    /* ---------- build deep-link for Custom-Tab ---------- */
    const url = new URL(location.href);
    url.searchParams.set('from', 'cta');        // small flag so we know weâ€™re back
    const callback = encodeURIComponent(url.toString());

    const androidIntent =
      `intent://authorize/` +
      `?cluster=mainnet-beta` +
      `&callback_url=${callback}` +
      `#Intent;scheme=solana-wallet;package=app.phantom;S.browser_fallback_url=${encodeURIComponent(location.href)};end;`;

    const iosUniversal = `https://phantom.app/ul/authorize/${callback}?cluster=mainnet-beta`;

    document.getElementById('btn').addEventListener('click', () => {
      const link = /iPhone|iPad|iPod/.test(navigator.userAgent) ? iosUniversal : androidIntent;
      location.href = link;
    });

    /* ---------- on return, read the address ---------- */
    const params = new URLSearchParams(location.hash.slice(1));
    if (params.get('address')) {
      document.getElementById('addr').textContent = `Connected: ${params.get('address')}`;
    }
  </script>
</body>
</html>
